Metadata-Version: 2.1
Name: fpls
Version: 0.1.0
Summary: Functional Partial Least Squares
Author-email: Andrii Babii <andrii.babii@example.com>, Marine Carrasco <marine.carrasco@example.com>, Idriss Tsafack <idriss.tsafack@example.com>
License: MIT
Project-URL: Homepage, https://github.com/ababii/fpls
Project-URL: Documentation, https://github.com/ababii/fpls#readme
Project-URL: Repository, https://github.com/ababii/fpls
Keywords: functional data analysis,functional partial least squares,regression,statistics
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Scientific/Engineering :: Mathematics
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: numpy>=1.20.0
Requires-Dist: pandas>=1.3.0
Provides-Extra: selection
Requires-Dist: statsmodels>=0.13.0; extra == "selection"
Provides-Extra: plotting
Requires-Dist: matplotlib>=3.3.0; extra == "plotting"
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=5.0.0; extra == "dev"
Requires-Dist: mypy>=0.990; extra == "dev"
Provides-Extra: all
Requires-Dist: statsmodels>=0.13.0; extra == "all"
Requires-Dist: matplotlib>=3.3.0; extra == "all"

# FPLS: Functional Partial Least Squares

[![PyPI version](https://img.shields.io/pypi/v/fpls.svg?color=blue)](https://pypi.org/project/fpls/)
[![Downloads](https://static.pepy.tech/personalized-badge/fpls?period=total&units=international_system&left_color=blue&right_color=grey&left_text=Downloads)](https://pepy.tech/project/fpls)
[![GitHub issues](https://img.shields.io/github/issues/ababii/fpls.svg)](https://github.com/ababii/fpls/issues)
[![License](https://img.shields.io/github/license/ababii/fpls.svg)](https://github.com/ababii/fpls/blob/main/LICENSE)

A Python package for functional regression using Partial Least Squares (PLS), implementing the methods developed in:

> **Babii, A., Carrasco, M., & Tsafack, I.** (2025). ["Functional Partial Least-Squares: Adaptive Estimation and Inference."](https://www.tandfonline.com/doi/full/10.1080/01621459.2025.2582874) *Journal of the American Statistical Association*.

## Overview

The **fpls** package provides a clean, scikit-learn-style API for fitting functional PLS regression models with adaptive component selection. The core algorithm uses a conjugate gradient method to solve the functional PLS problem, with integrals approximated via Riemann sums on uniform grids.

**Key Features:**
- **FunctionalPLS estimator** with `.fit()`, `.predict()`, and `.fit_predict()` methods
- **Adaptive early stopping** for automatic component selection
- Support for both **NumPy arrays** and **Pandas DataFrames**
- **Visualization tools** for plotting coefficient functions

## Installation

Install library:

```bash
pip install fpls
```

## Quick Start

### Example: Temperature Effects on Crop Yields

This example demonstrates FPLS using real agricultural data, analyzing how temperature exposure affects corn and soybean yields.

```python
from fpls import load_example_data, fit_fpls, plot_comparison

# Load corn and soybean data
X_corn, y_corn, s = load_example_data("corn")
X_soy, y_soy, _ = load_example_data("soybeans")

# Fit FPLS models with 10 components
coef_corn, _ = fit_fpls(X_corn, y_corn, m_max=10, ds=1.0)
coef_soy, _ = fit_fpls(X_soy, y_soy, m_max=10, ds=1.0)

# Extract coefficients using 4 components
beta_corn = coef_corn[:, 4]
beta_soy = coef_soy[:, 4]

# Plot comparison
fig, axes = plot_comparison(
    s_list=[s, s],
    beta_list=[beta_corn, beta_soy],
    titles=["Impact of Temperature on Corn Yield", 
            "Impact of Temperature on Soybeans Yield"],
    xlabel="Temperature (°C)",
    ylabel="Log Yield (Bushels)",
    colors=["#2E86AB", "#E85D04"]
)
import matplotlib.pyplot as plt
plt.show()
```

The coefficient functions reveal how different temperature ranges affect crop yields, with the functional approach capturing smooth nonlinear relationships that traditional methods might miss.

### Basic Functional Regression

```python
import numpy as np
from fpls import FunctionalPLS

# Generate synthetic functional data
n_samples = 200
n_grid_points = 50

X = np.random.randn(n_samples, n_grid_points)
beta_true = np.sin(np.linspace(0, 2*np.pi, n_grid_points))
y = X @ beta_true + np.random.randn(n_samples) * 0.5

# Fit Functional PLS
model = FunctionalPLS(m_max=10)
model.fit(X, y, ds=1.0)

# Predict
y_pred = model.predict(X, n_components=5)

# Evaluate
from fpls import compute_r2
r2 = compute_r2(y, y_pred)
print(f"R² = {r2:.3f}")
```

### Adaptive Component Selection

```python
from fpls import select_components

# Automatically select the optimal number of components
m_hat = select_components(X, y, m_max=10, tau=1.01, delta=0.1)
print(f"Selected {m_hat} components")

# Fit with selected components
model = FunctionalPLS(m_max=m_hat)
model.fit(X, y)
y_pred = model.predict(X)
```

### Visualizing Results

```python
from fpls import plot_coefficient_function
import numpy as np

# Plot a single coefficient function
s = np.linspace(0, 1, n_grid_points)
fig, ax = plot_coefficient_function(
    s, 
    model.coef_[:, 5],
    title="FPLS Coefficient Function (5 components)",
    xlabel="Functional Domain",
    ylabel="Coefficient Value"
)
plt.show()
```

## API Reference

### Main Classes

**`FunctionalPLS(m_max=10, grid_size=None)`**
- `.fit(X, y, ds=None)` - Fit the model
- `.predict(X, n_components=None)` - Make predictions
- `.fit_predict(X, y, ds=None, n_components=None)` - Fit and predict
- `.coef_` - Fitted coefficients (shape: `n_features × (m_max+1)`)

### Functions

**`fit_fpls(X, y, m_max=10, ds=None)`**
- Convenience function returning `(coef, ds)` tuple

**`select_components(X, y, m_max=10, ds=None, tau=1.01, delta=0.1, xi=0.01)`**
- Adaptive early stopping to select optimal number of components

**Visualization:**
- `plot_coefficient_function(s, beta, ...)` - Plot single coefficient function
- `plot_comparison(s_list, beta_list, titles, ...)` - Compare multiple functions
- `load_example_data(dataset)` - Load example datasets ('corn' or 'soybeans')

**Utilities:**
- `create_uniform_grid(start, end, n_points)` - Create discretization grid
- `compute_mse(y_true, y_pred)` - Mean squared error
- `compute_r2(y_true, y_pred)` - R-squared
- `center_functional_data(X)` - Center by mean function
- `frisch_waugh_residualize(Z, X_controls)` - Residualize out controls

## Examples

See the `examples/` directory for complete worked examples, including:
- Basic functional regression
- Component selection
- Crop yield analysis

## Citation

If you use this package in your research, please cite:

```bibtex
@article{babii2023functional,
  title={Functional Partial Least-Squares: Adaptive Estimation and Inference},
  author={Babii, Andrii and Carrasco, Marine and Tsafack, Idriss},
  journal={Journal of the American Statistical Association},
  year={2025}
}
```

## License

MIT License - see LICENSE file for details.

## Authors

- Andrii Babii
- Marine Carrasco
- Idriss Tsafack
